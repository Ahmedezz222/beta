<main class="product-detail container" role="main">
  <article class="product-content">
    <div class="product-images">
      {%- assign featured_media = product.featured_media | default: product.media.first -%}
      {% if featured_media %}
        <img
          id="main-product-image"
          srcset="{%- if featured_media.width >= 360 -%}{{ featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                  {%- if featured_media.width >= 720 -%}{{ featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                  {%- if featured_media.width >= 940 -%}{{ featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                  {%- if featured_media.width >= 1200 -%}{{ featured_media | image_url: width: 1200 }} 1200w{%- endif -%}"
          src="{{ featured_media | image_url: width: 720 }}"
          sizes="(min-width: 1024px) 560px, (min-width: 768px) 50vw, 100vw"
          alt="{{ featured_media.alt | default: product.title | escape }}"
          loading="lazy"
          width="{{ featured_media.width }}"
          height="{{ featured_media.height }}"
        >
      {% endif %}
      {% if product.images.size > 1 %}
        <div class="product-gallery" id="product-thumbnails">
          {% for image in product.images %}
            <img
              class="product-thumbnail{% if forloop.first %} active{% endif %}"
              data-full="{{ image | image_url: width: 1200 }}"
              src="{{ image | image_url: width: 300 }}"
              alt="{{ product.title }} - Image {{ forloop.index }}"
              loading="lazy"
              width="150"
              height="120"
            >
          {% endfor %}
        </div>
      {% endif %}
    </div>
    
    <div class="product-info">
      <header class="product-header">
        <h1>{{ product.title }}</h1>
        <div class="product-rating-large">
          <div class="star-rating">
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
          </div>
          <span class="rating-score-large">5.0</span>
          <span class="rating-count-large">(24 reviews)</span>
        </div>
        {%- assign selected_variant = product.selected_or_first_available_variant -%}
        <div class="product-price" id="product-price">
          <span class="price" data-price>{{ selected_variant.price | money }}</span>
          {% if selected_variant.compare_at_price > selected_variant.price %}
            <span class="compare-price" data-compare>{{ selected_variant.compare_at_price | money }}</span>
            <span class="discount-badge" data-savings>
              Save {{ selected_variant.compare_at_price | minus: selected_variant.price | money }}
            </span>
          {% endif %}
        </div>
      </header>
      
      <div class="product-description">
        {{ product.description }}
      </div>
      
      <form action="/cart/add" method="post" enctype="multipart/form-data" class="product-form" id="product-form">
        {% if product.has_only_default_variant %}
          <input type="hidden" name="id" value="{{ selected_variant.id }}">
        {% else %}
          <div class="form-group">
            <label for="variant-select" class="form-label">Select an option</label>
            <select id="variant-select" name="id" class="form-input">
              {% for variant in product.variants %}
                <option
                  value="{{ variant.id }}"
                  {% if variant.id == selected_variant.id %}selected{% endif %}
                  {% unless variant.available %}disabled{% endunless %}
                >
                  {{ variant.title }}{% unless variant.available %} â€“ Sold out{% endunless %}
                </option>
              {% endfor %}
            </select>
          </div>
        {% endif %}
        <div class="quantity-selector">
          <label for="quantity">Quantity:</label>
          <input type="number" id="quantity" name="quantity" value="1" min="1" max="99">
        </div>
        <button type="submit" class="btn btn-primary add-to-cart-btn" id="add-to-cart-btn" {% unless selected_variant.available %}disabled{% endunless %}>
          <span class="btn-text">{% if selected_variant.available %}Add to Cart{% else %}Sold out{% endif %}</span>
          {% render 'icon-symbol', icon_symbol: 'ðŸ›’' %}
        </button>
      </form>
      
      <div class="product-meta">
        <div class="availability" id="availability">
          {% if selected_variant.available %}
            <span class="status available">In Stock</span>
          {% else %}
            <span class="status">Out of stock</span>
          {% endif %}
        </div>
        <div class="shipping-info">
          <p>Free shipping on orders over $50</p>
          <p>30-day return policy</p>
        </div>
      </div>
    </div>
  </article>
  
  <!-- Product Reviews Section -->
  <section class="product-reviews" aria-labelledby="reviews-title">
    <div class="reviews-header">
      <h2 id="reviews-title">Customer Reviews</h2>
      <div class="overall-rating">
        <div class="rating-summary">
          <div class="rating-score-large">4.8</div>
          <div class="star-rating">
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
            <span class="star filled">â˜…</span>
          </div>
          <div class="rating-stats-large">Based on 24 reviews</div>
        </div>
      </div>
    </div>
    
    <div class="reviews-grid">
      <div class="review-item">
        <div class="review-header">
          <div class="reviewer-info">
            <h4>Sarah M.</h4>
            <div class="star-rating small">
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
            </div>
          </div>
          <div class="review-date">2 weeks ago</div>
        </div>
        <p class="review-text">"Excellent bike! Perfect for my daily commute. The quality is outstanding and the service was great."</p>
      </div>
      
      <div class="review-item">
        <div class="review-header">
          <div class="reviewer-info">
            <h4>Mike R.</h4>
            <div class="star-rating small">
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
            </div>
          </div>
          <div class="review-date">1 month ago</div>
        </div>
        <p class="review-text">"Great value for money. The bike handles well and the build quality is solid. Highly recommend!"</p>
      </div>
      
      <div class="review-item">
        <div class="review-header">
          <div class="reviewer-info">
            <h4>Lisa K.</h4>
            <div class="star-rating small">
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
              <span class="star filled">â˜…</span>
            </div>
          </div>
          <div class="review-date">3 weeks ago</div>
        </div>
        <p class="review-text">"Perfect for weekend rides. Comfortable and reliable. The staff helped me choose the right size."</p>
      </div>
    </div>
    
    <div class="review-cta">
      <button class="btn btn-primary">Write a Review</button>
    </div>
  </section>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const mainImage = document.getElementById('main-product-image');
      const thumbs = document.querySelectorAll('#product-thumbnails .product-thumbnail');
      thumbs.forEach(function(img) {
        img.addEventListener('click', function() {
          const full = this.getAttribute('data-full');
          if (full && mainImage) {
            mainImage.src = full;
            thumbs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
          }
        });
      });

      const variantSelect = document.getElementById('variant-select');
      const priceEl = document.querySelector('#product-price [data-price]');
      const compareEl = document.querySelector('#product-price [data-compare]');
      const savingsEl = document.querySelector('#product-price [data-savings]');
      const addBtn = document.getElementById('add-to-cart-btn');
      const availability = document.getElementById('availability');

      if (variantSelect) {
        variantSelect.addEventListener('change', function() {
          const selectedOption = this.options[this.selectedIndex];
          const isSoldOut = selectedOption.disabled;
          if (addBtn) {
            addBtn.disabled = isSoldOut;
            addBtn.querySelector('.btn-text').textContent = isSoldOut ? 'Sold out' : 'Add to Cart';
          }
          if (availability) {
            availability.innerHTML = isSoldOut ? '<span class="status">Out of stock</span>' : '<span class="status available">In Stock</span>';
          }
          // Optional: update price via data attributes if embedded on options
          const price = selectedOption.getAttribute('data-price');
          const compare = selectedOption.getAttribute('data-compare');
          if (priceEl && price) { priceEl.textContent = price; }
          if (compareEl) {
            if (compare) {
              compareEl.textContent = compare;
              compareEl.style.display = '';
            } else {
              compareEl.style.display = 'none';
            }
          }
          if (savingsEl) {
            if (price && compare) {
              savingsEl.style.display = '';
            } else {
              savingsEl.style.display = 'none';
            }
          }
        });
      }
    });
  </script>
</main>
